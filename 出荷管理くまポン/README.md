# Kintone 出荷管理くまポンアプリ カスタマイズ JS

このディレクトリは、Kintone の「出荷管理くまポン」アプリで使用される JavaScript カスタマイズファイルを管理します。
各ファイルは特定の業務プロセスを自動化・効率化するための機能を提供します。

## ファイル構成と役割

### 1. `出荷依頼データ取込_くまポン_250331.js`

- **役割:** 出荷依頼データの取得
- **動作ビュー ID:** `6424111`
- **機能:**
  - 一覧画面に「出荷依頼データを取得」ボタンを設置します。
  - ボタンクリックにより、GAS（Google Apps Script）の Web API を呼び出し、出荷依頼データを Kintone に取り込みます。

### 2. `消込データCSV出力_くまポン_250225.js`

- **役割:** 消込用データの CSV 出力
- **動作ビュー ID:** `6425354`
- **機能:**
  - 一覧画面に「消込データ CSV を出力」ボタンを設置します。
  - 表示されているレコードを配送業者ごとにグループ化し、それぞれ CSV ファイルとして出力します。
  - 出力後、対象レコードの「運用ステータス」を「消込データ出力済み」に更新します。

### 3. `不備修正を出荷依頼に反映_250216.js`

- **役割:** 不備修正内容の出荷依頼アプリへの反映
- **動作ビュー ID:** なし（詳細画面で動作）
- **機能:**
  - 詳細画面に「不備修正を出荷依頼に反映」ボタンを設置します。
  - ボタンクリックにより、現在のレコードの修正済み住所等の情報を、関連する「出荷指示」アプリの該当レコードに転記・更新します。
  - 更新前に、入力内容の不備チェックを再度実行します。

## JS ファイルの読み込み順序について

各ファイルはそれぞれ独立したイベント（特定のビューでのボタンクリック）をトリガーとして動作するため、読み込み順序に依存しません。

---

## 追加仕様

### 4. `消込データCSV出力_TEMU.js`

- **役割:** TEMU 用消込データ CSV 出力
- **動作ビュー ID:** `6428851`
- **機能:**

  - 「TEMU 消し込み CSV を出力」ボタンを設置。
  - ビュー条件で表示されているレコードのみを対象に処理。
  - 出力 CSV の構成は以下の通り：

    | CSV 列名    | 取得フィールド                                                           | 備考           |
    | ----------- | ------------------------------------------------------------------------ | -------------- |
    | オーダー ID | （空欄）                                                                 | 固定空欄       |
    | 注文商品 ID | ID\_くまポン用                                                           |                |
    | 数量        | 数量                                                                     |                |
    | 発送元      | 送り先郵便番号 + 送り先都道府県 + 送り先住所 1 + 送り先住所 2 + 送り先名 | フィールド結合 |
    | 配送会社    | 配送業者                                                                 |                |
    | 追跡番号    | 伝票 No                                                                  |                |

  - 出力後、「運用ステータス」を「消込データ出力済み」に更新。
  - 100 件単位のバッチ更新で API 負荷を最小化。

### 5. `消込データCSV出力_WELBOX.js`

- **役割:** WELBOX 用消込データ CSV 出力
- **動作ビュー ID:** `6428595`
- **機能:**

  - 「WELBOX\_消し込み CSV を出力」ボタンを設置。
  - ビュー条件で表示されているレコードのみを対象に処理。
  - 出力 CSV の構成は以下の通り：

    | CSV 列名             | 取得フィールド           | 備考                             |
    | -------------------- | ------------------------ | -------------------------------- |
    | オーダー ID          | 購入番号                 |                                  |
    | 配送業者コード       | 配送業者（カスタム変換） | 佐川急便=2, ゆうパケット=3       |
    | その他配送業者       | （空欄）                 | 固定空欄                         |
    | 配送方法             | 配送業者（カスタム変換） | 佐川急便=宅配, ゆうパケット=郵便 |
    | 送り状 No            | 伝票 No                  |                                  |
    | 荷物お問い合わせ URL | （空欄）                 | 固定空欄                         |
    | 出荷日               | 発送日                   |                                  |
    | 出荷指示日           | （空欄）                 | 固定空欄                         |
    | 会員メッセージ備考   | （空欄）                 | 固定空欄                         |

  - 出力後、「運用ステータス」を「消込データ出力済み」に更新。
  - 100 件単位で分割して安全に更新。
  - API コールを最小限に抑える設計。
